{"version":3,"sources":["../src/input_components/TextInput.tsx"],"names":[],"mappings":"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","file":"TextInput.js","sourcesContent":["import * as React from 'react';\nimport styled from 'styled-components';\nconst Quagga = require('quagga');\nimport { FaBarcode } from 'react-icons/fa';\nimport oh from 'output-helpers';\nimport { LooseObject } from '../index';\n\nexport interface TextInputConfig {\n    label?: string;\n    class_name?: string;\n    barcode?: boolean;\n    barcode_stream_visible: boolean;\n    barcode_stream_failed: boolean;\n}\nexport interface TextInputProps {\n    value: string;\n    config: TextInputConfig;\n    onChange: (string) => void;\n    autofocus?: boolean;\n}\n\nconst CameraError = styled(\"div\")`\n    position: absolute;\n    left: 5%;\n    top: 5%;\n    right: 5%;\n    padding: 20px;\n    background-color: #c12a22;\n    color: #fff;\n    font-size: 16px;\n`;\n\nclass TextInput extends React.Component<TextInputProps, TextInputConfig> {\n    container: typeof React.Component;\n    barcode_stream_target: HTMLDivElement|null;\n    barcode_stream_failed: boolean;\n    detectedCB: (data: LooseObject) => void;\n\n    constructor(props) {\n        super(props);\n\n        this.container = styled.div `\n            text-align: left;\n            p{\n                color: ${props => props.theme.colors.dark[1]};\n                font-size: 14px;\n                margin-bottom: 12px;\n                font-weight: bold;\n            }\n            input{\n                border: 2px solid ${props => props.theme.colors.gray[2]};\n                border-radius: 4px;\n                font-size: 16px;\n                padding: 8px 12px;\n                width: 100%;\n                transition: all 0.3s;\n                &:HOVER, &:FOCUS{\n                    border-color: ${props => props.theme.colors.brand[2]};\n                }\n                &.small{\n                    width: calc(100% - 80px);\n                    display: inline-block;\n                    vertical-align: middle;\n                }\n            }\n            .barcode_reader{\n                display: inline-block;\n                width: 70px;\n                .barcode_btn{\n                    background-color: #1378ef;\n                    margin-left: 10px;\n                    width: 70px;\n                    text-align: center;\n                    height: 50px;\n                    vertical-align: middle;\n                    border-radius: 4px;\n                    svg{\n                        height: 50px;\n                        width: 36px;\n                        vertical-align: middle;\n                        fill: #fff;\n                    }\n                }\n            }\n\n            .barcode_stream_target{\n                display: none;\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 93%;\n                z-index: 1000000;\n                &.show {\n                    display: block;\n                }\n            }\n            .barcode_stream_target_close_btn{\n                text-align: center;\n                padding: 20px;\n                background-color: #EB4D44;\n                color: #fff;\n                font-weight: bold;\n                border-radius: 4px;\n                box-shadow: 0 5px 10px rgba(0,0,0,0.2);\n                /* width: 100%; */\n                bottom: 20px;\n                left: 20px;\n                right: 20px;\n                z-index: 16000000;\n                position: absolute;\n                &:HOVER{\n                    background-color: #c12a22;\n                }\n            }\n        `;\n\n        this.barcode_stream_target = null;\n\n        this.state = {\n            barcode_stream_visible: false,\n            barcode_stream_failed: false\n        };\n\n        this.detectedCB = (data) => {\n            Quagga.offDetected(this.detectedCB);\n            Quagga.stop();\n            let result = data.codeResult.code;\n            this.props.onChange(result);\n            this.setState({\n                barcode_stream_visible: false\n            });\n        };\n\n    }\n\n    startBarcodeReading() {\n        if (!this.barcode_stream_target) {\n            return;\n        }\n        let quagga_config = {\n            numOfWorkers: navigator.hardwareConcurrency,\n            locate: true,\n            inputStream: {\n                name: \"Live\",\n                type: \"LiveStream\",\n                constraints: {\n                    width: 1280,\n                    height: 720,\n                    facingMode: \"environment\"\n                },\n                target: this.barcode_stream_target\n            },\n            frequency: 5,\n            decoder: {\n                readers: [\"code_128_reader\", \"code_39_reader\", \"ean_reader\"]\n            },\n            locator: {\n                halfSample: true,\n                patchSize: \"medium\"\n            }\n        };\n\n        this.setState({\n            barcode_stream_visible: true\n        });\n\n        Quagga.init(quagga_config, (err) => {\n            if (err) {\n                console.error(err);\n                this.setState({\n                    barcode_stream_failed: true\n                });\n                return;\n            }\n\n            Quagga.onDetected(this.detectedCB);\n\n            Quagga.start();\n        });\n    }\n\n\n\n    renderBarcodeBtn(cfg) {\n        if (cfg.barcode !== true) {\n            return null;\n        }\n\n        let barcode_stream_classes = [\"barcode_stream_target\"];\n\n        if (this.state.barcode_stream_visible) {\n            barcode_stream_classes.push(\"show\");\n        }\n\n        return (\n            <div className=\"barcode_reader\">\n                <div className=\"barcode_btn\"\n                    onClick={() => {\n                        this.startBarcodeReading();\n                    }}\n                >\n                    <FaBarcode />\n                </div>\n                {\n                    this.state.barcode_stream_failed === true ?\n                    <CameraError>\n                        <p>{ oh.translate(\"camera_error\") }</p>\n                    </CameraError>\n                    :\n                    null\n                }\n                <div\n                    className={barcode_stream_classes.join(\" \")}\n                    ref={(ref) => { this.barcode_stream_target = ref; }}\n                >\n                    <div\n                        className={\"barcode_stream_target_close_btn\"}\n                        onClick={() => {\n                            Quagga.offDetected(this.detectedCB);\n                            Quagga.stop();\n                            this.setState({\n                                barcode_stream_visible: false\n                            });\n                        }}\n                    >\n                        { oh.translate(\"user_input_hoc_cancel\") }\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n\n\n    render() {\n        let cfg = this.props.config;\n        let class_names = \"user_input text_input\";\n        if (cfg.class_name) {\n            class_names += \" \" + cfg.class_name;\n        }\n\n        let input_class_name = \"full\";\n        if (cfg.barcode === true) {\n            input_class_name = \"small\";\n        }\n\n        return (\n            <this.container className={class_names}>\n                { cfg.label ? <p>{ cfg.label }</p> : null }\n                <input\n                    className={input_class_name}\n                    autoFocus={this.props.autofocus || false}\n                    type=\"text\"\n                    value={this.props.value}\n                    onChange={e => this.props.onChange(e.target.value)}\n                />\n                { this.renderBarcodeBtn(cfg) }\n            </this.container>\n        );\n    }\n}\n\nexport default TextInput;\n"]}