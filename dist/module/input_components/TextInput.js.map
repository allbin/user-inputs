{"version":3,"sources":["../src/module/input_components/TextInput.tsx"],"names":[],"mappings":"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","file":"TextInput.js","sourcesContent":["import * as React from 'react';\r\nimport styled from 'styled-components';\r\nconst Quagga = require('quagga');\r\nimport { FaBarcode } from 'react-icons/fa';\r\nimport oh from 'output-helpers';\r\nimport { LooseObject } from '../.';\r\n\r\nexport interface TextInputConfig {\r\n    type: \"text\";\r\n    key: string;\r\n    default_value: string;\r\n    barcode?: boolean;\r\n    class_name?: string;\r\n    label?: string;\r\n    message?: string;\r\n    /** TODO: Implement tooltip */\r\n    tooltip?: string;\r\n    trim?: boolean;\r\n    onValueChange?: (value: string) => void;\r\n    validationCB?: (value: string) => null|string;\r\n}\r\nexport interface TextInputProps {\r\n    value: string;\r\n    config: TextInputConfig;\r\n    onChange: (value: string, cb: () => void) => void;\r\n    display_error_message: boolean;\r\n    autofocus?: boolean;\r\n}\r\n\r\ninterface TextInputState {\r\n    barcode_stream_visible: boolean;\r\n}\r\n\r\ninterface ContainerStyleProps {\r\n    valid: boolean;\r\n}\r\n\r\nconst TextInputContainer = styled(\"div\")<ContainerStyleProps> `\r\n    text-align: left;\r\n    margin-bottom: ${props => props.theme.components.form.user_input.margin_bottom}px;\r\n    p{\r\n        color: ${props => props.theme.colors.dark[1]};\r\n        font-size: 14px;\r\n        margin-bottom: 8px;\r\n        font-weight: bold;\r\n    }\r\n    p.message{\r\n        color: ${props => props.theme.colors.dark[2]};\r\n        font-size: 12px;\r\n        margin-bottom: 6px;\r\n        font-weight: normal;\r\n        font-style: italic;\r\n    }\r\n    p.validation_error{\r\n        color: ${props => props.theme.colors.red[0]};\r\n        font-size: 14px;\r\n        margin-bottom: 4px;\r\n        font-weight: bold;\r\n        font-style: italic;\r\n    }\r\n    input{\r\n        background-color: ${props => !props.valid ? \"rgba(255,0,0,0.1)\" : \"\" };\r\n        border: 1px solid ${props => !props.valid ? props.theme.colors.error : props.theme.colors.border};\r\n        border-radius: 4px;\r\n        font-size: 16px;\r\n        padding: 8px 12px;\r\n        width: 100%;\r\n        transition: all 0.3s;\r\n        &:HOVER, &:FOCUS{\r\n            border-color: ${props => !props.valid ? props.theme.colors.error : props.theme.colors.brand[2]};\r\n        }\r\n        &.small{\r\n            width: calc(100% - 80px);\r\n            display: inline-block;\r\n            vertical-align: middle;\r\n        }\r\n    }\r\n    .barcode_reader{\r\n        display: inline-block;\r\n        width: 70px;\r\n        .barcode_btn{\r\n            background-color: #1378ef;\r\n            margin-left: 10px;\r\n            width: 70px;\r\n            text-align: center;\r\n            height: 50px;\r\n            vertical-align: middle;\r\n            border-radius: 4px;\r\n            svg{\r\n                height: 50px;\r\n                width: 36px;\r\n                vertical-align: middle;\r\n                fill: #fff;\r\n            }\r\n        }\r\n    }\r\n\r\n    .barcode_stream_target{\r\n        display: none;\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 93%;\r\n        z-index: 1000000;\r\n        &.show {\r\n            display: block;\r\n        }\r\n    }\r\n    .barcode_stream_target_close_btn{\r\n        text-align: center;\r\n        padding: 20px;\r\n        background-color: #EB4D44;\r\n        color: #fff;\r\n        font-weight: bold;\r\n        border-radius: 4px;\r\n        box-shadow: 0 5px 10px rgba(0,0,0,0.2);\r\n        /* width: 100%; */\r\n        bottom: 20px;\r\n        left: 20px;\r\n        right: 20px;\r\n        z-index: 16000000;\r\n        position: absolute;\r\n        &:HOVER{\r\n            background-color: #c12a22;\r\n        }\r\n    }\r\n`;\r\nexport class Input extends React.Component<TextInputProps, TextInputState> {\r\n    barcode_stream_target: HTMLDivElement|null;\r\n    detectedCB: (data: LooseObject) => void;\r\n\r\n    constructor(props: TextInputProps) {\r\n        super(props);\r\n\r\n        this.barcode_stream_target = null;\r\n\r\n        this.state = {\r\n            barcode_stream_visible: false\r\n        };\r\n\r\n        this.detectedCB = (data) => {\r\n            Quagga.offDetected(this.detectedCB);\r\n            Quagga.stop();\r\n            let result = data.codeResult.code;\r\n            this.setState({\r\n                barcode_stream_visible: false\r\n            }, () => {\r\n                this.onChange(result);\r\n            });\r\n        };\r\n\r\n    }\r\n\r\n    startBarcodeReading() {\r\n        if (!this.barcode_stream_target) {\r\n            return;\r\n        }\r\n        let quagga_config = {\r\n            numOfWorkers: navigator.hardwareConcurrency,\r\n            locate: true,\r\n            inputStream: {\r\n                name: \"Live\",\r\n                type: \"LiveStream\",\r\n                constraints: {\r\n                    width: 1280,\r\n                    height: 720,\r\n                    facingMode: \"environment\"\r\n                },\r\n                target: this.barcode_stream_target\r\n            },\r\n            frequency: 5,\r\n            decoder: {\r\n                readers: [\"code_128_reader\", \"code_39_reader\", \"ean_reader\"]\r\n            },\r\n            locator: {\r\n                halfSample: true,\r\n                patchSize: \"medium\"\r\n            }\r\n        };\r\n\r\n        this.setState({\r\n            barcode_stream_visible: true\r\n        });\r\n\r\n        Quagga.init(quagga_config, (err: any) => {\r\n            if (err) {\r\n                console.error(err);\r\n                throw err;\r\n            }\r\n\r\n            Quagga.onDetected(this.detectedCB);\r\n\r\n            Quagga.start();\r\n        });\r\n    }\r\n\r\n\r\n\r\n    renderBarcodeBtn(cfg: TextInputConfig) {\r\n        if (cfg.barcode !== true) {\r\n            return null;\r\n        }\r\n\r\n        let barcode_stream_classes = [\"barcode_stream_target\"];\r\n        if (this.state.barcode_stream_visible) {\r\n            barcode_stream_classes.push(\"show\");\r\n        }\r\n\r\n        return (\r\n            <div className=\"barcode_reader\">\r\n                <div className=\"barcode_btn\"\r\n                    onClick={() => {\r\n                        this.startBarcodeReading();\r\n                    }}\r\n                >\r\n                    <FaBarcode />\r\n                </div>\r\n                <div\r\n                    className={barcode_stream_classes.join(\" \")}\r\n                    ref={(ref) => { this.barcode_stream_target = ref; }}\r\n                >\r\n                    <div\r\n                        className={\"barcode_stream_target_close_btn\"}\r\n                        onClick={() => {\r\n                            Quagga.offDetected(this.detectedCB);\r\n                            Quagga.stop();\r\n                            this.setState({\r\n                                barcode_stream_visible: false\r\n                            });\r\n                        }}\r\n                    >\r\n                        { oh.translate(\"user_input_cancel\") }\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    onChange(value: string) {\r\n        const cfg = this.props.config;\r\n        this.props.onChange(value, () => {\r\n            let ext_value = convertInternalToExternalValue(cfg, value);\r\n            if (cfg.onValueChange && !validate(cfg, ext_value)) {\r\n                cfg.onValueChange(ext_value);\r\n            }\r\n        });\r\n    }\r\n\r\n    render() {\r\n        let cfg = this.props.config;\r\n        let class_names = \"user_input text_input\";\r\n        if (cfg.class_name) {\r\n            class_names += \" \" + cfg.class_name;\r\n        }\r\n\r\n        let input_class_name = \"full\";\r\n        if (cfg.barcode === true) {\r\n            input_class_name = \"small\";\r\n        }\r\n\r\n        const validation_error = validate(cfg, this.props.value);\r\n\r\n        return (\r\n            <TextInputContainer\r\n                className={class_names}\r\n                valid={!validation_error || !this.props.display_error_message}\r\n            >\r\n                { cfg.label ? <p>{ cfg.label }</p> : null }\r\n                { cfg.message ? <p className=\"message\">{ cfg.message }</p> : null }\r\n                { validation_error && this.props.display_error_message && validation_error.length > 0 ? <p className=\"validation_error\">{ validation_error }</p> : null }\r\n                <input\r\n                    className={input_class_name}\r\n                    autoFocus={this.props.autofocus || false}\r\n                    type=\"text\"\r\n                    value={this.props.value}\r\n                    onChange={e => this.onChange(e.target.value)}\r\n                />\r\n                { this.renderBarcodeBtn(cfg) }\r\n            </TextInputContainer>\r\n        );\r\n    }\r\n}\r\n\r\nexport function validate(cfg: TextInputConfig, value: string): null|string {\r\n    if (cfg.validationCB) {\r\n        return cfg.validationCB(value);\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function validateConfig(cfg: TextInputConfig): null|string {\r\n\r\n\r\n    return null;\r\n}\r\n\r\nexport function convertInternalToExternalValue(cfg: TextInputConfig, value: string): string {\r\n    if (!cfg.trim) {\r\n        return value;\r\n    }\r\n    return value.trim();\r\n}\r\n\r\nexport function convertExternalToInternalValue(cfg: TextInputConfig, value: any): string {\r\n    return value.toString();\r\n}\r\n"]}